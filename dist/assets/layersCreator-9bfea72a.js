import{j as T}from"./Collection-54857936.js";import"./string-bf9c68ed.js";import{E as f}from"./promiseUtils-3ce2a460.js";import{a as n}from"./lazyLayerLoader-e0b2746e.js";import g from"./PortalItem-8c677fd9.js";import{selectLayerClassPath as G}from"./portalLayers-066fc740.js";import{t as M}from"./styleUtils-30cd950e.js";import"./cast-4d1aa82d.js";import"./typedArrayUtil-c81d173a.js";import"./Error-9392329b.js";import"./ensureType-8c80e8c7.js";import"./nextTick-3ee5a785.js";import"./Evented-d69b5d66.js";import"./SimpleObservable-7e8b69a3.js";import"./preload-helper-101896b7.js";import"./assets-2d98ef96.js";import"./request-429c0e66.js";import"./Loadable-e19fba09.js";import"./Promise-24c50191.js";import"./Extent-52b65909.js";import"./Portal-4a02a9a8.js";import"./locale-30120714.js";import"./PortalGroup-45834c06.js";import"./PortalUser-bb0f9958.js";import"./layerUtils-c60873a1.js";import"./layersLoader-57ce817e.js";import"./Layer-3cc844b0.js";import"./geometry-8c15a791.js";import"./Polyline-7f90e3cc.js";import"./typeUtils-f38bdb16.js";import"./Identifiable-a49d7533.js";import"./arcgisLayerUrl-0567e8c8.js";import"./persistableUrlUtils-ef87bc82.js";import"./fetchService-432cf592.js";import"./jsonContext-c2f8af7e.js";import"./portalItemUtils-6225971d.js";import"./projection-676f1424.js";import"./mathUtils-505ef34b.js";import"./mat4-63147b80.js";import"./zscale-92e5f59b.js";import"./asyncUtils-d59cad3c.js";function A(e){return S(e,"notes")}function v(e){return S(e,"markup")}function w(e){return S(e,"route")}function S(e,r){return!(!e.layerType||e.layerType!=="ArcGISFeatureLayer")&&e.featureCollectionType===r}async function b(e,r,t){if(!r)return;const i=[];for(const a of r){const y=h(a,t);a.layerType==="GroupLayer"?i.push(k(y,a,t)):i.push(y)}const o=await f(i);for(const a of o)a.value&&e.add(a.value)}const W={ArcGISDimensionLayer:"DimensionLayer",ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",PointCloudLayer:"PointCloudLayer",ArcGISSceneServiceLayer:"SceneLayer",IntegratedMeshLayer:"IntegratedMeshLayer",OGCFeatureLayer:"OGCFeatureLayer",BuildingSceneLayer:"BuildingSceneLayer",ArcGISTiledElevationServiceLayer:"ElevationLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",GroupLayer:"GroupLayer",GeoJSON:"GeoJSONLayer",WebTiledLayer:"WebTileLayer",CSV:"CSVLayer",VectorTileLayer:"VectorTileLayer",WFS:"WFSLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer",KML:"KMLLayer",RasterDataLayer:"UnsupportedLayer",Voxel:"VoxelLayer",LineOfSightLayer:"LineOfSightLayer"},F={ArcGISTiledElevationServiceLayer:"ElevationLayer",DefaultTileLayer:"ElevationLayer",RasterDataElevationLayer:"UnsupportedLayer"},C={ArcGISTiledMapServiceLayer:"TileLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",OpenStreetMap:"OpenStreetMapLayer",WebTiledLayer:"WebTileLayer",VectorTileLayer:"VectorTileLayer",ArcGISImageServiceLayer:"UnsupportedLayer",WMS:"UnsupportedLayer",ArcGISMapServiceLayer:"UnsupportedLayer",ArcGISSceneServiceLayer:"SceneLayer",DefaultTileLayer:"TileLayer"},O={ArcGISAnnotationLayer:"UnsupportedLayer",ArcGISDimensionLayer:"UnsupportedLayer",ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISStreamLayer:"StreamLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",BingMapsAerial:"BingMapsLayer",BingMapsRoad:"BingMapsLayer",BingMapsHybrid:"BingMapsLayer",CSV:"CSVLayer",DefaultTileLayer:"TileLayer",GeoRSS:"GeoRSSLayer",GeoJSON:"GeoJSONLayer",GroupLayer:"GroupLayer",KML:"KMLLayer",MediaLayer:"MediaLayer",OGCFeatureLayer:"OGCFeatureLayer",OrientedImageryLayer:"OrientedImageryLayer",SubtypeGroupLayer:"SubtypeGroupLayer",VectorTileLayer:"VectorTileLayer",WFS:"WFSLayer",WMS:"WMSLayer",WebTiledLayer:"WebTileLayer"},V={ArcGISFeatureLayer:"FeatureLayer"},B={ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",OpenStreetMap:"OpenStreetMapLayer",VectorTileLayer:"VectorTileLayer",WebTiledLayer:"WebTileLayer",BingMapsAerial:"BingMapsLayer",BingMapsRoad:"BingMapsLayer",BingMapsHybrid:"BingMapsLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer"};async function h(e,r){return D(await U(e,r),e,r)}async function D(e,r,t){const i=new e;return i.read(r,t.context),i.type==="group"&&I(r)&&await E(i,r,t.context),await M(i,t.context),i}async function U(e,r){var L;const t=r.context,i=x(t);let o=e.layerType||e.type;!o&&r&&r.defaultLayerType&&(o=r.defaultLayerType);const a=i[o];let y=a?n[a]:n.UnknownLayer;if(d(e)){const p=t==null?void 0:t.portal;if(e.itemId){const c=new g({id:e.itemId,portal:p});await c.load();const l=(await G(c)).className||"UnknownLayer";y=n[l]}}else o==="ArcGISFeatureLayer"?A(e)||v(e)?y=n.MapNotesLayer:w(e)?y=n.RouteLayer:I(e)&&(y=n.GroupLayer):e.wmtsInfo&&e.wmtsInfo.url&&e.wmtsInfo.layerIdentifier?y=n.WMTSLayer:o==="WFS"&&((L=e.wfsInfo)==null?void 0:L.version)!=="2.0.0"&&(y=n.UnsupportedLayer);return y()}function I(e){var r,t;return e.layerType!=="ArcGISFeatureLayer"||d(e)?!1:(((t=(r=e.featureCollection)==null?void 0:r.layers)==null?void 0:t.length)??0)>1}function d(e){return e.type==="Feature Collection"}function x(e){let r;if(e.origin==="web-scene")switch(e.layerContainerType){case"basemap":r=C;break;case"ground":r=F;break;default:r=W}else switch(e.layerContainerType){case"basemap":r=B;break;case"tables":r=V;break;default:r=O}return r}async function k(e,r,t){const i=new T,o=b(i,Array.isArray(r.layers)?r.layers:[],t),a=await e;if(await o,a.type==="group")return a.layers.addMany(i),a}async function E(e,r,t){var p;const i=n.FeatureLayer,o=await i(),a=r.featureCollection,y=a==null?void 0:a.showLegend,L=(p=a==null?void 0:a.layers)==null?void 0:p.map((c,l)=>{var m;const s=new o;s.read(c,t);const u={...t,ignoreDefaults:!0};return s.read({id:`${e.id}-sublayer-${l}`,visibility:((m=r.visibleLayers)==null?void 0:m.includes(l))??!0},u),y!=null&&s.read({showLegend:y},u),s});e.layers.addMany(L??[])}export{b as populateOperationalLayers};
