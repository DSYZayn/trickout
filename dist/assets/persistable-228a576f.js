import{_ as P}from"./preload-helper-101896b7.js";import{i as x}from"./multiOriginJSONSupportUtils-c978f4c3.js";import{Y as N,Z as y,V as _,k as O}from"./request-429c0e66.js";import{n as R}from"./uuid-73213768.js";import{m as $,U as b,D as S}from"./cast-4d1aa82d.js";import{t as f}from"./resourceExtension-f73a9b73.js";import{p as j,m as d,R as F,U as J,d as A,x as D}from"./persistableUrlUtils-ef87bc82.js";function M(r){const o=(r==null?void 0:r.origins)??[void 0];return(t,s)=>{const n=E(r,t,s);for(const i of o){const a=$(t,i,s);for(const e in n)a[e]=n[e]}}}function E(r,o,t){if((r==null?void 0:r.type)==="resource")return T(r,o,t);switch((r==null?void 0:r.type)??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:s,write:n}=D;return{read:s,write:n}}}}function T(r,o,t){const s=b(o,t);return{type:String,read:(n,i,a)=>{const e=j(n,i,a);return s.type===String?e:typeof s.type=="function"?new s.type({url:e}):void 0},write:{writer(n,i,a,e){if(!e||!e.resources)return typeof n=="string"?void(i[a]=d(n,e)):void(i[a]=n.write({},e));const m=K(n),p=d(m,{...e,verifyItemRelativeUrls:e&&e.verifyItemRelativeUrls?{writtenUrls:e.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},F.NO),c=s.type!==String&&(!x(this)||e&&e.origin&&this.originIdOf(t)>S(e.origin)),u={object:this,propertyName:t,value:n,targetUrl:p,dest:i,targetPropertyName:a,context:e,params:r};e&&e.portalItem&&p&&!N(p)?c?V(u):k(u):e&&e.portalItem&&(p==null||J(p)!=null||y(p)||c)?g(u):i[a]=p}}}}function g(r){const{targetUrl:o,params:t,value:s,context:n,dest:i,targetPropertyName:a}=r;if(!n.portalItem)return;const e=A(o),m=(e==null?void 0:e.filename)??R(),p=(t==null?void 0:t.prefix)??(e==null?void 0:e.prefix),c=v(s,o,n),u=_(p,m),U=`${u}.${f(c)}`,l=n.portalItem.resourceFromPath(U);y(o)&&n.resources&&n.resources.pendingOperations.push(B(o).then(w=>{l.path=`${u}.${f(w)}`,i[a]=l.itemRelativeUrl}).catch(()=>{}));const I=(t==null?void 0:t.compress)??!1;n.resources&&h({...r,resource:l,content:c,compress:I,updates:n.resources.toAdd}),i[a]=l.itemRelativeUrl}function V(r){const{context:o,targetUrl:t,params:s,value:n,dest:i,targetPropertyName:a}=r;if(!o.portalItem)return;const e=o.portalItem.resourceFromPath(t),m=v(n,t,o),p=f(m),c=O(e.path),u=(s==null?void 0:s.compress)??!1;p===c?(o.resources&&h({...r,resource:e,content:m,compress:u,updates:o.resources.toUpdate}),i[a]=t):g(r)}function k({context:r,targetUrl:o,dest:t,targetPropertyName:s}){r.portalItem&&r.resources&&(r.resources.toKeep.push({resource:r.portalItem.resourceFromPath(o),compress:!1}),t[s]=o)}function h({object:r,propertyName:o,updates:t,resource:s,content:n,compress:i}){t.push({resource:s,content:n,compress:i,finish:a=>{L(r,o,a)}})}function v(r,o,t){return typeof r=="string"?{url:o}:new Blob([JSON.stringify(r.toJSON(t))],{type:"application/json"})}async function B(r){const o=(await P(()=>import("./request-429c0e66.js").then(s=>s.I),["assets/request-429c0e66.js","assets/preload-helper-101896b7.js","assets/Error-9392329b.js","assets/string-bf9c68ed.js","assets/typedArrayUtil-c81d173a.js","assets/promiseUtils-3ce2a460.js"])).default,{data:t}=await o(r,{responseType:"blob"});return t}function K(r){return r==null?null:typeof r=="string"?r:r.url}function L(r,o,t){typeof r[o]=="string"?r[o]=t.url:r[o].url=t.url}export{M as g};
