import{a as rn}from"./request-429c0e66.js";import{u as s,B as w,U as W,r as L,J as A,V as F,d as O,w as P,G as J,x as b,y as d,S as E,E as y,H as j,I as k,l as R,K as en,M as an,O as un,P as B,b as z,Q as T,W as on,X as Z}from"./arcadeUtils-f4b9e7bd.js";import{p as m,a as S,w as M,$ as ln}from"./Extent-52b65909.js";import{A as cn,h as fn,S as sn,m as dn,x as mn,p as wn,O as pn,g as hn,R as yn,D as gn,b as vn,E as Pn,k as In,y as An,w as Fn,W as q,K as H,F as C,M as U,d as Rn,C as K,U as V,B as Nn,L as xn,P as bn,v as Sn,H as G,N as Q,J as On,j as Jn}from"./geometryEngineAsync-43cffeb2.js";import{m as N,v as x,u as X}from"./Polyline-7f90e3cc.js";import{v as Y}from"./jsonUtils-e2434b33.js";import{t as u,e as o}from"./executionError-fb3f283a.js";import{t as _,s as $}from"./portalUtils-39aeda7b.js";import"./preload-helper-101896b7.js";import"./Error-9392329b.js";import"./string-bf9c68ed.js";import"./typedArrayUtil-c81d173a.js";import"./promiseUtils-3ce2a460.js";import"./geometry-8c15a791.js";import"./ensureType-8c80e8c7.js";import"./typeUtils-f38bdb16.js";import"./cast-4d1aa82d.js";import"./nextTick-3ee5a785.js";import"./arcadeTimeUtils-0a92beb1.js";import"./datetime-b6333958.js";import"./FieldsIndex-29a8df54.js";import"./fieldUtils-7c95d0c6.js";import"./TimeReference-d5a14980.js";import"./Clonable-ad03ca71.js";import"./number-0ccbbda1.js";import"./locale-30120714.js";import"./Field-899dc481.js";import"./enumeration-de0a766e.js";import"./fieldType-68c65bf7.js";import"./featureConversionUtils-93a98860.js";import"./aaBoundingBox-55a55434.js";import"./mathUtils-505ef34b.js";import"./aaBoundingRect-062d7c89.js";import"./OptimizedFeature-6361f5d1.js";import"./OptimizedFeatureSet-1d1ac4b9.js";import"./Portal-4a02a9a8.js";import"./Loadable-e19fba09.js";import"./Promise-24c50191.js";import"./PortalGroup-45834c06.js";import"./PortalUser-bb0f9958.js";import"./sizeVariableUtils-d4870b0d.js";import"./workers-6ae37cc2.js";import"./Connection-ee309efe.js";import"./Queue-4939205d.js";import"./assets-2d98ef96.js";import"./intl-806fa328.js";import"./number-b98554af.js";import"./messages-57170cca.js";function nn(e){return rn.indexOf("4.")===0?x.fromExtent(e):new x({spatialReference:e.spatialReference,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]})}function I(e,t,r){if(w(e,2,2,t,r),!(e[0]instanceof m&&e[1]instanceof m)){if(!(e[0]instanceof m&&e[1]===null)){if(!(e[1]instanceof m&&e[0]===null)){if(e[0]!==null||e[1]!==null)throw new u(t,o.InvalidParameter,r)}}}}async function tn(e,t){if(e.type!=="polygon"&&e.type!=="polyline"&&e.type!=="extent")return 0;let r=1;(e.spatialReference.vcsWkid||e.spatialReference.latestVcsWkid)&&(r=on(e.spatialReference)/ln(e.spatialReference));let l=0;if(e.type==="polyline")for(const n of e.paths)for(let i=1;i<n.length;i++)l+=Z(n[i],n[i-1],r);else if(e.type==="polygon")for(const n of e.rings){for(let i=1;i<n.length;i++)l+=Z(n[i],n[i-1],r);(n[0][0]!==n[n.length-1][0]||n[0][1]!==n[n.length-1][1]||n[0][2]!==void 0&&n[0][2]!==n[n.length-1][2])&&(l+=Z(n[0],n[n.length-1],r))}else e.type==="extent"&&(l+=2*Z([e.xmin,e.ymin,0],[e.xmax,e.ymin,0],r),l+=2*Z([e.xmin,e.ymin,0],[e.xmin,e.ymax,0],r),l*=2,l+=4*Math.abs(d(e.zmax,0)*r-d(e.zmin,0)*r));const f=new N({hasZ:!1,hasM:!1,spatialReference:e.spatialReference,paths:[[0,0],[0,l]]});return C(f,t)}function Nt(e){e.mode==="async"&&(e.functions.disjoint=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>(I(n=s(n),t,r),n[0]===null||n[1]===null||cn(n[0],n[1])))},e.functions.intersects=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>(I(n=s(n),t,r),n[0]!==null&&n[1]!==null&&fn(n[0],n[1])))},e.functions.touches=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>(I(n=s(n),t,r),n[0]!==null&&n[1]!==null&&sn(n[0],n[1])))},e.functions.crosses=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>(I(n=s(n),t,r),n[0]!==null&&n[1]!==null&&dn(n[0],n[1])))},e.functions.within=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>(I(n=s(n),t,r),n[0]!==null&&n[1]!==null&&mn(n[0],n[1])))},e.functions.contains=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>(I(n=s(n),t,r),n[0]!==null&&n[1]!==null&&wn(n[0],n[1])))},e.functions.overlaps=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>(I(n=s(n),t,r),n[0]!==null&&n[1]!==null&&pn(n[0],n[1])))},e.functions.equals=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>(w(n,2,2,t,r),n[0]===n[1]||(n[0]instanceof m&&n[1]instanceof m?hn(n[0],n[1]):!(!W(n[0])||!W(n[1]))&&n[0].equals(n[1]))))},e.functions.relate=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>{if(n=s(n),w(n,3,3,t,r),n[0]instanceof m&&n[1]instanceof m)return yn(n[0],n[1],L(n[2]));if(n[0]instanceof m&&n[1]===null||n[1]instanceof m&&n[0]===null||n[0]===null&&n[1]===null)return!1;throw new u(t,o.InvalidParameter,r)})},e.functions.intersection=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>(I(n=s(n),t,r),n[0]===null||n[1]===null?null:gn(n[0],n[1])))},e.functions.union=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>{const i=[];if((n=s(n)).length===0)throw new u(t,o.WrongNumberOfParameters,r);if(n.length===1)if(A(n[0])){const a=s(n[0]);for(let c=0;c<a.length;c++)if(a[c]!==null){if(!(a[c]instanceof m))throw new u(t,o.InvalidParameter,r);i.push(a[c])}}else{if(!F(n[0])){if(n[0]instanceof m)return O(P(n[0]),t.spatialReference);if(n[0]===null)return null;throw new u(t,o.InvalidParameter,r)}{const a=s(n[0].toArray());for(let c=0;c<a.length;c++)if(a[c]!==null){if(!(a[c]instanceof m))throw new u(t,o.InvalidParameter,r);i.push(a[c])}}}else for(let a=0;a<n.length;a++)if(n[a]!==null){if(!(n[a]instanceof m))throw new u(t,o.InvalidParameter,r);i.push(n[a])}return i.length===0?null:vn(i)})},e.functions.difference=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>(I(n=s(n),t,r),n[0]!==null&&n[1]===null?P(n[0]):n[0]===null?null:Pn(n[0],n[1])))},e.functions.symmetricdifference=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>(I(n=s(n),t,r),n[0]===null&&n[1]===null?null:n[0]===null?P(n[1]):n[1]===null?P(n[0]):In(n[0],n[1])))},e.functions.clip=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>{if(n=s(n),w(n,2,2,t,r),!(n[1]instanceof S)&&n[1]!==null)throw new u(t,o.InvalidParameter,r);if(n[0]===null)return null;if(!(n[0]instanceof m))throw new u(t,o.InvalidParameter,r);return n[1]===null?null:An(n[0],n[1])})},e.functions.cut=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>{if(n=s(n),w(n,2,2,t,r),!(n[1]instanceof N)&&n[1]!==null)throw new u(t,o.InvalidParameter,r);if(n[0]===null)return[];if(!(n[0]instanceof m))throw new u(t,o.InvalidParameter,r);return n[1]===null?[P(n[0])]:Fn(n[0],n[1])})},e.functions.area=function(t,r){return e.standardFunctionAsync(t,r,async(l,f,n)=>{if(w(n,1,2,t,r),(n=s(n))[0]===null)return 0;if(J(n[0])){const i=await n[0].sumArea(b(d(n[1],-1)),!1,t.abortSignal);if(t.abortSignal.aborted)throw new u(t,o.Cancelled,r);return i}if(A(n[0])||F(n[0])){const i=E(n[0],t.spatialReference);return i===null?0:q(i,b(d(n[1],-1)))}if(!(n[0]instanceof m))throw new u(t,o.InvalidParameter,r);return q(n[0],b(d(n[1],-1)))})},e.functions.areageodetic=function(t,r){return e.standardFunctionAsync(t,r,async(l,f,n)=>{if(w(n,1,2,t,r),(n=s(n))[0]===null)return 0;if(J(n[0])){const i=await n[0].sumArea(b(d(n[1],-1)),!0,t.abortSignal);if(t.abortSignal.aborted)throw new u(t,o.Cancelled,r);return i}if(A(n[0])||F(n[0])){const i=E(n[0],t.spatialReference);return i===null?0:H(i,b(d(n[1],-1)))}if(!(n[0]instanceof m))throw new u(t,o.InvalidParameter,r);return H(n[0],b(d(n[1],-1)))})},e.functions.length=function(t,r){return e.standardFunctionAsync(t,r,async(l,f,n)=>{if(w(n,1,2,t,r),(n=s(n))[0]===null)return 0;if(J(n[0])){const i=await n[0].sumLength(y(d(n[1],-1)),!1,t.abortSignal);if(t.abortSignal.aborted)throw new u(t,o.Cancelled,r);return i}if(A(n[0])||F(n[0])){const i=j(n[0],t.spatialReference);return i===null?0:C(i,y(d(n[1],-1)))}if(!(n[0]instanceof m))throw new u(t,o.InvalidParameter,r);return C(n[0],y(d(n[1],-1)))})},e.functions.length3d=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>{if(w(n,1,2,t,r),(n=s(n))[0]===null)return 0;if(A(n[0])||F(n[0])){const i=j(n[0],t.spatialReference);return i===null?0:i.hasZ===!0?tn(i,y(d(n[1],-1))):C(i,y(d(n[1],-1)))}if(!(n[0]instanceof m))throw new u(t,o.InvalidParameter,r);return n[0].hasZ===!0?tn(n[0],y(d(n[1],-1))):C(n[0],y(d(n[1],-1)))})},e.functions.lengthgeodetic=function(t,r){return e.standardFunctionAsync(t,r,async(l,f,n)=>{if(w(n,1,2,t,r),(n=s(n))[0]===null)return 0;if(J(n[0])){const i=await n[0].sumLength(y(d(n[1],-1)),!0,t.abortSignal);if(t.abortSignal.aborted)throw new u(t,o.Cancelled,r);return i}if(A(n[0])||F(n[0])){const i=j(n[0],t.spatialReference);return i===null?0:U(i,y(d(n[1],-1)))}if(!(n[0]instanceof m))throw new u(t,o.InvalidParameter,r);return U(n[0],y(d(n[1],-1)))})},e.functions.distance=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>{n=s(n),w(n,2,3,t,r);let i=n[0];(A(n[0])||F(n[0]))&&(i=k(n[0],t.spatialReference));let a=n[1];if((A(n[1])||F(n[1]))&&(a=k(n[1],t.spatialReference)),!(i instanceof m))throw new u(t,o.InvalidParameter,r);if(!(a instanceof m))throw new u(t,o.InvalidParameter,r);return Rn(i,a,y(d(n[2],-1)))})},e.functions.distancegeodetic=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>{n=s(n),w(n,2,3,t,r);const i=n[0],a=n[1];if(!(i instanceof M))throw new u(t,o.InvalidParameter,r);if(!(a instanceof M))throw new u(t,o.InvalidParameter,r);const c=new N({paths:[],spatialReference:i.spatialReference});return c.addPath([i,a]),U(c,y(d(n[2],-1)))})},e.functions.densify=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>{if(n=s(n),w(n,2,3,t,r),n[0]===null)return null;if(!(n[0]instanceof m))throw new u(t,o.InvalidParameter,r);const i=R(n[1]);if(isNaN(i))throw new u(t,o.InvalidParameter,r);if(i<=0)throw new u(t,o.InvalidParameter,r);return n[0]instanceof x||n[0]instanceof N?K(n[0],i,y(d(n[2],-1))):n[0]instanceof S?K(nn(n[0]),i,y(d(n[2],-1))):n[0]})},e.functions.densifygeodetic=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>{if(n=s(n),w(n,2,3,t,r),n[0]===null)return null;if(!(n[0]instanceof m))throw new u(t,o.InvalidParameter,r);const i=R(n[1]);if(isNaN(i))throw new u(t,o.InvalidParameter,r);if(i<=0)throw new u(t,o.InvalidParameter,r);return n[0]instanceof x||n[0]instanceof N?V(n[0],i,y(d(n[2],-1))):n[0]instanceof S?V(nn(n[0]),i,y(d(n[2],-1))):n[0]})},e.functions.generalize=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>{if(n=s(n),w(n,2,4,t,r),n[0]===null)return null;if(!(n[0]instanceof m))throw new u(t,o.InvalidParameter,r);const i=R(n[1]);if(isNaN(i))throw new u(t,o.InvalidParameter,r);return Nn(n[0],i,en(d(n[2],!0)),y(d(n[3],-1)))})},e.functions.buffer=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>{if(n=s(n),w(n,2,3,t,r),n[0]===null)return null;if(!(n[0]instanceof m))throw new u(t,o.InvalidParameter,r);const i=R(n[1]);if(isNaN(i))throw new u(t,o.InvalidParameter,r);return i===0?P(n[0]):xn(n[0],i,y(d(n[2],-1)))})},e.functions.buffergeodetic=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>{if(n=s(n),w(n,2,3,t,r),n[0]===null)return null;if(!(n[0]instanceof m))throw new u(t,o.InvalidParameter,r);const i=R(n[1]);if(isNaN(i))throw new u(t,o.InvalidParameter,r);return i===0?P(n[0]):bn(n[0],i,y(d(n[2],-1)))})},e.functions.offset=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>{if(n=s(n),w(n,2,6,t,r),n[0]===null)return null;if(!(n[0]instanceof x||n[0]instanceof N))throw new u(t,o.InvalidParameter,r);const i=R(n[1]);if(isNaN(i))throw new u(t,o.InvalidParameter,r);const a=R(d(n[4],10));if(isNaN(a))throw new u(t,o.InvalidParameter,r);const c=R(d(n[5],0));if(isNaN(c))throw new u(t,o.InvalidParameter,r);return Sn(n[0],i,y(d(n[2],-1)),L(d(n[3],"round")).toLowerCase(),a,c)})},e.functions.rotate=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>{n=s(n),w(n,2,3,t,r);let i=n[0];if(i===null)return null;if(!(i instanceof m))throw new u(t,o.InvalidParameter,r);i instanceof S&&(i=x.fromExtent(i));const a=R(n[1]);if(isNaN(a))throw new u(t,o.InvalidParameter,r);const c=d(n[2],null);if(c===null)return G(i,a);if(c instanceof M)return G(i,a,c);throw new u(t,o.InvalidParameter,r)})},e.functions.centroid=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>{if(n=s(n),w(n,1,1,t,r),n[0]===null)return null;let i=n[0];if((A(n[0])||F(n[0]))&&(i=k(n[0],t.spatialReference)),i===null)return null;if(!(i instanceof m))throw new u(t,o.InvalidParameter,r);return i instanceof M?O(P(n[0]),t.spatialReference):i instanceof x?i.centroid:i instanceof N?an(i):i instanceof X?un(i):i instanceof S?i.center:null})},e.functions.multiparttosinglepart=function(t,r){return e.standardFunctionAsync(t,r,async(l,f,n)=>{n=s(n),w(n,1,1,t,r);const i=[];if(n[0]===null)return null;if(!(n[0]instanceof m))throw new u(t,o.InvalidParameter,r);if(n[0]instanceof M)return[O(P(n[0]),t.spatialReference)];if(n[0]instanceof S)return[O(P(n[0]),t.spatialReference)];const a=await Q(n[0]);if(a instanceof x){const c=[],h=[];for(let p=0;p<a.rings.length;p++)if(a.isClockwise(a.rings[p])){const g=Y({rings:[a.rings[p]],hasZ:a.hasZ===!0,hazM:a.hasM===!0,spatialReference:a.spatialReference.toJSON()});c.push(g)}else h.push({ring:a.rings[p],pt:a.getPoint(p,0)});for(let p=0;p<h.length;p++)for(let g=0;g<c.length;g++)if(c[g].contains(h[p].pt)){c[g].addRing(h[p].ring);break}return c}if(a instanceof N){const c=[];for(let h=0;h<a.paths.length;h++){const p=Y({paths:[a.paths[h]],hasZ:a.hasZ===!0,hazM:a.hasM===!0,spatialReference:a.spatialReference.toJSON()});c.push(p)}return c}if(n[0]instanceof X){const c=O(P(n[0]),t.spatialReference);for(let h=0;h<c.points.length;h++)i.push(c.getPoint(h));return i}return null})},e.functions.issimple=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>{if(n=s(n),w(n,1,1,t,r),n[0]===null)return!0;if(!(n[0]instanceof m))throw new u(t,o.InvalidParameter,r);return On(n[0])})},e.functions.simplify=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>{if(n=s(n),w(n,1,1,t,r),n[0]===null)return null;if(!(n[0]instanceof m))throw new u(t,o.InvalidParameter,r);return Q(n[0])})},e.functions.convexhull=function(t,r){return e.standardFunctionAsync(t,r,(l,f,n)=>{if(n=s(n),w(n,1,1,t,r),n[0]===null)return null;if(!(n[0]instanceof m))throw new u(t,o.InvalidParameter,r);return Jn(n[0])})},e.functions.getuser=function(t,r){return e.standardFunctionAsync(t,r,async(l,f,n)=>{w(n,0,2,t,r);let i=d(n[1],""),a=i===!0;if(i=i===!0||i===!1?"":L(i),n.length===0||n[0]instanceof B){let h=null;t.services&&t.services.portal&&(h=t.services.portal),n.length>0&&(h=_(n[0],h));const p=await $(h,i,a);if(p){const g=JSON.parse(JSON.stringify(p));for(const v of["lastLogin","created","modified"])g[v]!==void 0&&g[v]!==null&&(g[v]=new Date(g[v]));return z.convertObjectToArcadeDictionary(g,T(t))}return null}let c=null;if(J(n[0])&&(c=n[0]),c){if(a=!1,i)return null;await c.load();const h=await c.getOwningSystemUrl();if(!h){if(!i){const v=await c.getIdentityUser();return v?z.convertObjectToArcadeDictionary({username:v},T(t)):null}return null}let p=null;t.services&&t.services.portal&&(p=t.services.portal),p=_(new B(h),p);const g=await $(p,i,a);if(g){const v=JSON.parse(JSON.stringify(g));for(const D of["lastLogin","created","modified"])v[D]!==void 0&&v[D]!==null&&(v[D]=new Date(v[D]));return z.convertObjectToArcadeDictionary(v,T(t))}return null}throw new u(t,o.InvalidParameter,r)})})}export{Nt as registerFunctions};
